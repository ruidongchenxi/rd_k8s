创建
[root@master-1 configmap]# kubectl create configmap tomcat-config --from-literal=tomcat_prot=8080 --from-literal=server_name=myapp.tomcat.com
configmap/tomcat-config created
查看
[root@master-1 configmap]# kubectl get configmaps 
NAME               DATA   AGE
kube-root-ca.crt   1      169d
tomcat-config      2      22s
查看
[root@master-1 configmap]# kubectl get cm
NAME               DATA   AGE
kube-root-ca.crt   1      169d
tomcat-config      2      2m44s
查看指定configmap详细信息
[root@master-1 configmap]# kubectl describe cm tomcat-config
Name:         tomcat-config
Namespace:    default
Labels:       <none>
Annotations:  <none>

Data
====
server_name:
----
myapp.tomcat.com
to_prot:
----
8080
Events:  <none>

创建一个配置文件
[root@master-1 configmap]# cat ng.conf 
server{
server_name www.nginx.com;
listen 80;
root /home/nginx/www;
}
指定文件创建名叫www-nginx的configmap
[root@master-1 configmap]# kubectl create configmap www-nginx --from-file=www=./ng.conf 
configmap/www-nginx created
[root@master-1 configmap]# kubectl get configmaps 
NAME               DATA   AGE
kube-root-ca.crt   1      169d
tomcat-config      2      10h
www-nginx          1      13s
查看详情
[root@master-1 configmap]# kubectl describe cm www-nginx 
Name:         www-nginx
Namespace:    default
Labels:       <none>
Annotations:  <none>

Data
====
www:
----
server{
server_name www.nginx.com;
listen 80;
root /home/nginx/www;
}

Events:  <none>
指定目录创建configmap
[root@master-1 configmap]# mkdir cx-1
[root@master-1 configmap]# cd cx-1/
[root@master-1 cx-1]# ls
[root@master-1 cx-1]# vim my.conf
[root@master-1 cx-1]# vim my-1.conf
[root@master-1 cx-1]# cd ../
[root@master-1 configmap]# cd -
/opt/k8s/rd_k8s/k8s/configmap/cx-1
[root@master-1 cx-1]# cat my
my-1.conf  my.conf    
[root@master-1 cx-1]# cat my.conf 
service=1
[root@master-1 cx-1]# cat my-1.conf 
service=2
[root@master-1 cx-1]# cd ../
[root@master-1 configmap]# kubectl create configmap cx --from-file=./cx-1/
configmap/cx created
[root@master-1 configmap]# kubectl describe configmaps cx
Name:         cx
Namespace:    default
Labels:       <none>
Annotations:  <none>

Data
====
my-1.conf:
----
service=2

my.conf:
----
service=1

Events:  <none>
[root@master-1 configmap]# kubectl create configmap cx-2 --from-file=./cx-1
configmap/cx-2 created
[root@master-1 configmap]# kubectl apply -f pod.yaml  
pod/mysql-pod created
[root@master-1 configmap]# kubectl get pod
NAME                                      READY   STATUS    RESTARTS   AGE
mysql-pod                                 1/1     Running   0          16s
nfs-client-provisioner-7c7bf9f6bd-dp5h8   1/1     Running   18         55d
nginx-test                                1/1     Running   17         160d
storage-0                                 1/1     Running   13         54d
storage-1                                 1/1     Running   13         54d
[root@master-1 configmap]# kubectl describe pod mysql-pod
Name:         mysql-pod
Namespace:    default
Priority:     0
Node:         node-1/192.168.10.30
Start Time:   Sat, 08 Jul 2023 14:23:42 +0800
Labels:       <none>
Annotations:  cni.projectcalico.org/podIP: 10.244.84.181/32
              cni.projectcalico.org/podIPs: 10.244.84.181/32
Status:       Running
IP:           10.244.84.181
IPs:
  IP:  10.244.84.181
Containers:
  mysql:
    Container ID:  docker://e6e62ad6a453e704b74f5c553741cbc781ca9b42a9a1176d362357dfba0452af
    Image:         busybox
    Image ID:      docker-pullable://busybox@sha256:2376a0c12759aa1214ba83e771ff252c7b1663216b192fbe5e0fb364e952f85c
    Port:          <none>
    Host Port:     <none>
    Command:
      /bin/sh
      -c
      sleep 3600
    State:          Running
      Started:      Sat, 08 Jul 2023 14:23:51 +0800
    Ready:          True
    Restart Count:  0
    Environment:
      log_bin:  <set to the key 'log' of config map 'mysql'>    Optional: false
      lower:    <set to the key 'lower' of config map 'mysql'>  Optional: false
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-w7bhz (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  default-token-w7bhz:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-w7bhz
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  33s   default-scheduler  Successfully assigned default/mysql-pod to node-1
  Normal  Pulling    32s   kubelet            Pulling image "busybox"
  Normal  Pulled     25s   kubelet            Successfully pulled image "busybox" in 7.054387965s
  Normal  Created    25s   kubelet            Created container mysql
  Normal  Started    25s   kubelet            Started container mysql
[root@master-1 configmap]# kubectl get pod
NAME                                      READY   STATUS    RESTARTS   AGE
mysql-pod                                 1/1     Running   0          49s
nfs-client-provisioner-7c7bf9f6bd-dp5h8   1/1     Running   18         55d
nginx-test                                1/1     Running   17         160d
storage-0                                 1/1     Running   13         54d
storage-1                                 1/1     Running   13         54d

热加载
进入容器
[root@master-1 configmap]# kubectl exec -it chenxi-1 -c mysql -- /bin/sh
# cd /tmp/config
# cat my.cnf    
[mysql]
welana=cx
# cat log
1# cat lower
1#  
更新配置
[root@master-1 configmap]# kubectl edit cm mysql-1 

# Please edit the object below. Lines beginning with a '#' will be ignored,
# and an empty file will abort the edit. If an error occurs while saving this file will be
# reopened with the relevant failures.
#
apiVersion: v1
data:
  log: "1"
  lower: "1"
  my.cnf: |
    [mysql]
    welana=cx
kind: ConfigMap
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","data":{"log":"1","lower":"1","my.cnf":"[mysql]\nwelana=cx\n"},"kind":"ConfigMap","metadata":{"annotations":{},"labels":{"app":"mysql"},"name":"mysql-1","namespace":"default"}}
  creationTimestamp: "2023-07-08T08:03:26Z"
  labels:
    app: mysql
  name: mysql-1
  namespace: default
  resourceVersion: "10808870"
  uid: b616cf2c-3cc1-4df3-9d81-563c077d9fb7
编辑
[root@master-1 configmap]# kubectl edit cm mysql-1 

# Please edit the object below. Lines beginning with a '#' will be ignored,
# and an empty file will abort the edit. If an error occurs while saving this file will be
# reopened with the relevant failures.
#
apiVersion: v1
data:
  log: "8" # 更新后的值
  lower: "7" # 更新后的值
  my.cnf: |
    [mysql]
    welana=cx-1dr# 更新后的值
kind: ConfigMap
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","data":{"log":"1","lower":"1","my.cnf":"[mysql]\nwelana=cx\n"},"kind":"ConfigMap","metadata":{"annotations":{},"labels":{"app":"mysql"},"name":"mysql-1","namespace":"default"}}
  creationTimestamp: "2023-07-08T08:03:26Z"
  labels:
    app: mysql
  name: mysql-1
  namespace: default
  resourceVersion: "10808870"
  uid: b616cf2c-3cc1-4df3-9d81-563c077d9fb7
更新后查看pod
[root@master-1 configmap]# kubectl exec -it chenxi-1 -c mysql -- /bin/sh
# cd /tmp/config
# cat my.cnf    
[mysql]
welana=cx
# cat log
1# cat lower
1# cat log
8# cat lower
7# cat my.cnf
[mysql]
welana=cx-1dr
# 

